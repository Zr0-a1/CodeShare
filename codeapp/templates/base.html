{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}CodeShare{% endblock %}</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Global Styles -->
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">

  <!-- Page-specific CSS -->
  {% block extra_css %}{% endblock %}
</head>

<body>

  <!-- NAVBAR / HEADER -->
  <header class="header">
    <div class="container nav-container">

      <!-- LOGO -->
      <div class="logo">
        <a href="{% url 'home' %}" class="logo-link">
          <span class="logo-icon">&lt;&lt;</span> CodeShare
        </a>
      </div>

      <!-- Hamburger (Mobile) -->
      <button class="nav-toggle" id="navToggle">â˜°</button>

      <!-- DESKTOP NAV LINKS -->
      <nav class="nav-links">

        <a href="{% url 'home' %}">Home</a>
        <a href="{% url 'browse' %}">Browse</a>

        {% if user.is_authenticated %}
          <a href="{% url 'upload' %}" class="btn btn-purple share-code">Share Code</a>

          <!-- Notification Bell -->
          <div class="notif-wrapper position-relative">
            <button class="notif-btn" id="notifBtn">
              ðŸ””
              {% if unread_count > 0 %}
                <span class="notif-badge">{{ unread_count }}</span>
              {% endif %}
            </button>

            <!-- Notification Dropdown -->
            <div class="notification-dropdown" id="notifDropdown">
              <h4>Notifications</h4>

              <ul>
                {% if notifications %}
                  {% for note in notifications %}
                    <li>{{ note.message }}</li>
                  {% endfor %}
                {% else %}
                  <li class="no-notif">No notifications</li>
                {% endif %}
              </ul>
            </div>
          </div>

          <!-- Profile link -->
          <a href="{% url 'user_profile' %}">Profile</a>

          <!-- Logout -->
          <a href="{% url 'logout' %}" class="btn btn-outline-purple">Logout</a>

        {% else %}
          <a href="{% url 'login' %}" class="btn btn-purple">Login</a>
          <a href="{% url 'register' %}" class="btn btn-outline-purple">Sign Up</a>
        {% endif %}

      </nav>
    </div>

    <!-- MOBILE MENU -->
    <div class="mobile-menu" id="mobileMenu">

      <a href="{% url 'home' %}">Home</a>
      <a href="{% url 'browse' %}">Browse</a>

      {% if user.is_authenticated %}
        <a href="{% url 'upload' %}">Share Code</a>
        <a href="{% url 'user_profile' %}">Profile</a>
        <a href="{% url 'notifications' %}">Notifications</a>

        <a href="{% url 'logout' %}" class="mobile-logout">Logout</a>

      {% else %}
        <a href="{% url 'login' %}">Login</a>
        <a href="{% url 'register' %}">Sign Up</a>
      {% endif %}

    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main>
    {% if messages %}
      <div class="container mt-3">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    {% block content %}{% endblock %}
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-logo">&lt;&lt; CodeShare</div>
      <div class="footer-links">
        <a href="#">About</a>
        <a href="#">Privacy</a>
        <a href="#">Terms</a>
      </div>
      <div class="footer-copy">Â© 2025 CodeShare â€” Share your code with the world.</div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- NAV JS -->
  <script>
    // Mobile Menu
    document.getElementById("navToggle").addEventListener("click", function () {
      document.getElementById("mobileMenu").classList.toggle("show");
    });

    // Notification Dropdown
    document.getElementById("notifBtn")?.addEventListener("click", function () {
      document.getElementById("notifDropdown").classList.toggle("show");
    });

    // Close notif dropdown when clicking outside
    document.addEventListener("click", function (e) {
      if (!e.target.closest(".notif-wrapper")) {
        document.getElementById("notifDropdown")?.classList.remove("show");
      }
    });
  </script>

  {% block extra_js %}{% endblock %}

</body>
</html>
